# ROUTE 路由         

## IP帧格式
<pre>
IPv4 Header
---------------------------------------------
|ver  |IHL |DSCP|ECN|total length           |
|4b   |4b  |6b  |2b |2 bytes                |
---------------------------------------------
|identification     |flags|fragment offset  |
|2 bytes            |3bits|13bits           |
--------------------------------------------
|ttl     |protocol  |Header checksum        |
|8 bits  |8 bits    |2 bytes                |
---------------------------------------------
|source IP address                          |
|4 bytes                                    |
---------------------------------------------
|destination IP address                     |
|4 bytes                                    |
---------------------------------------------
|options (up to 32 bits)                    |
---------------------------------------------
</pre>

version:for IPv4, this is always equal to 4.  
IHL:internet header length  

DSCP:Differentiated Services Code Point   
ECN:Explicit Congestion Notification  
total length:
flags:
fragment offset:ip层包长度超过1500，分片？？？

ttl:time to live  

MTU为65535bytes。

## 路由表

## 路由器主要功能

## 网关

gateway翻译为中文是门户，出入口，途径的意思，在网络设备中，被称之为网关。    
  
网关在网络通信中的基本作用跟其字面意思很像：    
当需要发送目标IP为非本网段数据包时，数据包会被转发到网关，网关转发出去。    
当其他网段的主机发送数据包到本网段时，会将数据包发送给网关，然后网关转发到内部。    
  
**网关是一个具有IP数据包转发能力的网络设备，一般而言是个路由器。**  
**网关的IP理论上可以是任意的IP，没有特殊要求。**  
**网关是一个网段的门户，自然要和其他的主机在一个网段内。**  
    
**路由表是网络设备三层通信的依据，非常的重要！**    
使用route -n查看本地的路由表，如下。    
<pre>  
Kernel IP routing table    
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface    
0.0.0.0         192.168.0.1     0.0.0.0         UG    100    0        0 eno1    
169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 eno1    
172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0    
192.168.0.0     0.0.0.0         255.255.255.0   U     100    0        0 eno1    
</pre>  
    
路由表有几个重要要素：    
[目的网段]：[掩码]：[网关]：[接口]    
  
**路由表项目可以是目的网段，也可以是单独的主机IP**  
  
## 路由表，网关是如何起作用的？  
当网络设备需要转发IP数据包，需要发送IP数据包时，首先要做的事情就是查路由表。    
通过查表，可以知道从哪个网卡接口将此IP数据包发送出去。    
  
路由表匹配原则：  
目的IP在匹配路由表时，一般有以下情况：  
  
(1)目的地址的网络号和主机号完全对应路由表项目，即网络号和主机号完全一样。  
比如：  
   目的地址    192.168.1.10  
   路由表项目  192.168.1.10  0.0.0.0  255.255.255.0 eth0  
(2)目的地址的网络号完全对应路由表中的项目，即网络号完全一样。  
比如：  
   目的地址    192.168.1.10  
   路由表项目  192.168.1.0   0.0.0.0  255.255.255.0 eth0  
(3)任意地址。  
比如：  
   目的地址    192.168.1.10  
   路由表项目  0.0.0.0  192.168.1.1  0.0.0.0  eth0  
  
路由表中网段和目的地址共同位与路由表中掩码，相同则表示匹配成功。  
以上三种情况，匹配度是越来越低的，路由表匹配的原则是最长匹配，选择匹配度最高的项。  
