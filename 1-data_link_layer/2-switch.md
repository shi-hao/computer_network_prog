# SWITCH--交换      
      
## 以太网协议帧格式      
4部分18字节      
<pre>      
--------------------------------------------------------------      
| Des MAC addr | Src MAC addr| Type     |   Payload  | FCS  |      
| 6bytes       | 6 bytes     | 2 bytes  |46-1500bytes|4bytes|      
--------------------------------------------------------------      
</pre>      
Type : Payload的协议类型编码      
FCS : frame checke sequence(32-bit CRC)，32比特CRC校验码。      
  
问：以太网协议报文中并没有frame长度的信息，那如何去判断一个frame的长度呢？    
答：frame中虽然没有长度信息，但是物理层有标识长度的机制，以太网依赖于物理层去区分    
两个frame数据包。    
  
问：以太网报文的最大长度？    
答：以太网报文最大长度不会超过1500bytes，这是报文格式规定的最大长度，即，MTU为1500bytes。  
      
## 交换机主要功能      
基于源MAC地址学习，基于目的MAC地址转发，防止环路。      
      
### 地址学习      
根据接收到以太网帧源MAC地址，生成MAC地址表。      
MAC地址表主要包含四部分：MAC地址，VLAN-ID，对应接口，类型。    
<pre>    
--------------------------------------------------------    
|MAC Address      VLAN       Port         Type    
--------------------------------------------------------    
|5689-982f-1f3c   1          GE0/0/1      dynamic    
|6489-782f-103b   1          GE0/0/2      static    
|6229-582e-1e3e   1          GE0/0/3      blackhole    
--------------------------------------------------------    
</pre>    
1.接口    
指的是交换机学习到该MAC地址的接口编号，一个接口可以学习到多个MAC地址。    
    
2.类型    
用来表示MAC地址表条目的类型，分三种，动态(dynamic)，静态(static)，黑洞(blackhole)    
--动态表示该MAC地址是交换机根据收到的以太网帧源MAC地址自主学习产生，默认老化时间300秒。    
--静态表示该MAC地址是手动配置，不可老化。    
--黑洞表示该MAC地址是手动配置的，用来过滤以某MAC地址为源和目的数据帧，不可老化。   

问：交换机通过什么协议生成MAC地址表?
答：交换机会根据接收到的以太网数据帧的源地址来生成MAC地址表，至于这个以太网数据帧是什么
    上层协议产生，交换机并不关心，交换机本身不会主动请求各个接口的上设备的MAC地址。

问：什么是老化时间？
答：当交换机某个接口学习到MAC地址后，计时开始，如果又再次接收到这个MAC地址，那么刷新老化时间
    为300s，如果300s内没有收到该MAC地址的以太网数据，那么该条目会从MAC地址表删除，如果300s内
    其他接口学习到此MAC地址，那么默认是后者接口覆盖之前的接口。  
      
### 帧的转发      
根据收到的以太网帧目的MAC地址，查询MAC地址表转发，转发有三种      
方式，flooding/forwarding/discarding      
      
1.flooding(泛洪)      
将一个接口收到的以太网数据帧，发送到所有其他的接口，叫做泛洪。      
      
当收到的以太网的目的MAC地址是广播/组播/未知单播时，会进行泛洪。      
未知单播的指，本地MAC地址表中没有目的MAC地址的表项。      
      
2.forwarding(转发)      
当接收到的以太网数据帧的目的MAC地址在本地MAC地址表中存在时，      
根据MAC地址表进行数据帧转发到对应接口。      
      
3.discarding(丢弃)      
默认情况下，交换机不会丢弃以太网帧，一般是人为控制丢弃以太网帧。      
      
### 防止环路      
什么是环路，环路危害。      
交换机接口有mac地址吗?有几个MAC地址？每个接口都需要不同的MAC地址吗？      
      
      
## 交换机端口安全      
将交换机学习到的MAC地址转化为安全MAC地址。对接入设备的MAC地址和接入设备的数量进行限制。      
1.安全MAC配置方式      
安全MAC地址有三种配置方式：      
dynamic secure MAC       
      
static secure MAC      
      
sticky secure MAC      
      
2.违规处理      
      
## MAC地址漂移      
  
## ARP表格    
ARP协议的本质是根据通过目的IP地址请求目的MAC地址，通过发送以太网广播数据包来      
请求MAC地址，将收到的MAC填入ARP缓存表，ARP缓存表存储的是IP地址和MAC地址的对应关系。      
<pre>      
IP					MAC									       
192.168.1.99		0xdd-0xee-0xcc-0x11-0xff-0xff		      
192.168.1.100		0xee-0xee-0xcc-0x11-0xff-0xff             
192.168.1.80		0xcc-0xee-0xcc-0x11-0xff-0xff		                 
      
192.168.2.100		0xaa-0xee-0xcc-0x11-0xff-0xff		      
</pre>   

## Q&A
问：交换机接口有mac地址吗?有几个MAC地址？每个接口都需要不同的MAC地址吗？      
答：原则上，MAC地址是全球唯一的，是设备的ID，标准的交换机和路由器设备本身只有一个MAC地址
	不论设备有多少个接口，MAC地址都是相同的。
